import React, { useState } from "react";
import "./ConnectCode.css";
import { useNavigate } from "react-router-dom";
import { ethers } from "ethers";
import { CONTRACT_ABI, CONTRACT_ADDRESS } from "../../../utils/contract";
import { useGetSigner } from "../chat_screen/useGetSigner";

function ConnectCode() {
  const nav = useNavigate();
  const [walletAddress, setWalletAddress] = useState("");
  const [error, setError] = useState("");
  const getsigner = useGetSigner();
  const bytecode = "608060405234801561000f575f80fd5b5060405161162938038061162983398181016040528101906100319190610449565b6001825111610075576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161006c90610523565b60405180910390fd5b5f81118015610085575081518111155b6100c4576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bb906105b1565b60405180910390fd5b806001819055505f5b8251811015610253575f73ffffffffffffffffffffffffffffffffffffffff16838281518110610100576100ff6105cf565b5b602002602001015173ffffffffffffffffffffffffffffffffffffffff160361015e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161015590610646565b60405180910390fd5b5f838281518110610172576101716105cf565b5b6020026020010151908060018154018082558091505060019003905f5260205f20015f9091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600160035f8584815181106101ef576101ee6105cf565b5b602002602001015173ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff02191690831515021790555080806001019150506100cd565b505050610664565b5f604051905090565b5f80fd5b5f80fd5b5f80fd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b6102b682610270565b810181811067ffffffffffffffff821117156102d5576102d4610280565b5b80604052505050565b5f6102e761025b565b90506102f382826102ad565b919050565b5f67ffffffffffffffff82111561031257610311610280565b5b602082029050602081019050919050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f61035082610327565b9050919050565b61036081610346565b811461036a575f80fd5b50565b5f8151905061037b81610357565b92915050565b5f61039361038e846102f8565b6102de565b905080838252602082019050602084028301858111156103b6576103b5610323565b5b835b818110156103df57806103cb888261036d565b8452602084019350506020810190506103b8565b5050509392505050565b5f82601f8301126103fd576103fc61026c565b5b815161040d848260208601610381565b91505092915050565b5f819050919050565b61042881610416565b8114610432575f80fd5b50565b5f815190506104438161041f565b92915050565b5f806040838503121561045f5761045e610264565b5b5f83015167ffffffffffffffff81111561047c5761047b610268565b5b610488858286016103e9565b925050602061049985828601610435565b9150509250929050565b5f82825260208201905092915050565b7f6f776e657273207265717569726564206d75737420677261746572207468616e5f8201527f2031000000000000000000000000000000000000000000000000000000000000602082015250565b5f61050d6022836104a3565b9150610518826104b3565b604082019050919050565b5f6020820190508181035f83015261053a81610501565b9050919050565b7f4e756d206f6620636f6e6669726d6174696f6e206973206e6f742073796e63205f8201527f77697468206e756d206f66206f776e6572000000000000000000000000000000602082015250565b5f61059b6031836104a3565b91506105a682610541565b604082019050919050565b5f6020820190508181035f8301526105c88161058f565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b7f496e76616c6964204f776e6572000000000000000000000000000000000000005f82015250565b5f610630600d836104a3565b915061063b826105fc565b602082019050919050565b5f6020820190508181035f83015261065d81610624565b9050919050565b610fb8806106715f395ff3fe60806040526004361061006f575f3560e01c80639ace38c21161004d5780639ace38c214610107578063c01a8c8414610145578063ee22610b1461016d578063f123e3b0146101895761006f565b8063025e7c27146100735780630b1cd2c0146100af578063163e52b4146100eb575b5f80fd5b34801561007e575f80fd5b50610099600480360381019061009491906109c1565b6101b3565b6040516100a69190610a2b565b60405180910390f35b3480156100ba575f80fd5b506100d560048036038101906100d091906109c1565b6101ed565b6040516100e29190610a5e565b60405180910390f35b61010560048036038101906101009190610aa1565b610308565b005b348015610112575f80fd5b5061012d600480360381019061012891906109c1565b6104cc565b60405161013c93929190610adb565b60405180910390f35b348015610150575f80fd5b5061016b600480360381019061016691906109c1565b61052c565b005b610187600480360381019061018291906109c1565b61074b565b005b348015610194575f80fd5b5061019d610984565b6040516101aa9190610b10565b60405180910390f35b5f81815481106101c1575f80fd5b905f5260205f20015f915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b5f6004805490508210610235576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161022c90610b83565b60405180910390fd5b5f805f90505b6001548110156102f95760025f8581526020019081526020015f205f80838154811061026a57610269610ba1565b5b905f5260205f20015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff16156102ec5781806102e890610bfb565b9250505b808060010191505061023b565b50600154811015915050919050565b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610376576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161036d90610c8c565b60405180910390fd5b5f34116103b8576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103af90610d1a565b60405180910390fd5b5f6004805490509050600460405180606001604052808473ffffffffffffffffffffffffffffffffffffffff1681526020013481526020015f1515815250908060018154018082558091505060019003905f5260205f2090600302015f909190919091505f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550602082015181600101556040820151816002015f6101000a81548160ff02191690831515021790555050507f753dcda37efe0bc3675e04e24d1fb08b70681f14675eed4b6e7978495caf2ca0813384346040516104c09493929190610d38565b60405180910390a15050565b600481815481106104db575f80fd5b905f5260205f2090600302015f91509050805f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690806001015490806002015f9054906101000a900460ff16905083565b60035f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff166105b5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105ac90610dc5565b60405180910390fd5b60048054905081106105fc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105f390610b83565b60405180910390fd5b60025f8281526020019081526020015f205f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff1615610695576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161068c90610e53565b60405180910390fd5b600160025f8381526020019081526020015f205f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff0219169083151502179055507fef524c298d730e7d5714dbe2fce9d4eca7de755a12628704719170afda39678b816040516107289190610b10565b60405180910390a1610739816101ed565b15610748576107478161074b565b5b50565b6004805490508110610792576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161078990610b83565b60405180910390fd5b600481815481106107a6576107a5610ba1565b5b905f5260205f2090600302016002015f9054906101000a900460ff1615610802576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107f990610ebb565b60405180910390fd5b5f6004828154811061081757610816610ba1565b5b905f5260205f2090600302015f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166004838154811061086f5761086e610ba1565b5b905f5260205f2090600302016001015460405161088b90610f06565b5f6040518083038185875af1925050503d805f81146108c5576040519150601f19603f3d011682016040523d82523d5f602084013e6108ca565b606091505b505090508061090e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161090590610f64565b60405180910390fd5b60016004838154811061092457610923610ba1565b5b905f5260205f2090600302016002015f6101000a81548160ff0219169083151502179055507f15ed165a284872ea7017f03df402a0cadfbfab588320ffaf83f160c2f82781c7826040516109789190610b10565b60405180910390a15050565b60015481565b5f80fd5b5f819050919050565b6109a08161098e565b81146109aa575f80fd5b50565b5f813590506109bb81610997565b92915050565b5f602082840312156109d6576109d561098a565b5b5f6109e3848285016109ad565b91505092915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610a15826109ec565b9050919050565b610a2581610a0b565b82525050565b5f602082019050610a3e5f830184610a1c565b92915050565b5f8115159050919050565b610a5881610a44565b82525050565b5f602082019050610a715f830184610a4f565b92915050565b610a8081610a0b565b8114610a8a575f80fd5b50565b5f81359050610a9b81610a77565b92915050565b5f60208284031215610ab657610ab561098a565b5b5f610ac384828501610a8d565b91505092915050565b610ad58161098e565b82525050565b5f606082019050610aee5f830186610a1c565b610afb6020830185610acc565b610b086040830184610a4f565b949350505050565b5f602082019050610b235f830184610acc565b92915050565b5f82825260208201905092915050565b7f496e76616c6964207472616e73616374696f6e000000000000000000000000005f82015250565b5f610b6d601383610b29565b9150610b7882610b39565b602082019050919050565b5f6020820190508181035f830152610b9a81610b61565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f610c058261098e565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8203610c3757610c36610bce565b5b600182019050919050565b7f496e76616c6964200000000000000000000000000000000000000000000000005f82015250565b5f610c76600883610b29565b9150610c8182610c42565b602082019050919050565b5f6020820190508181035f830152610ca381610c6a565b9050919050565b7f5472616e7366657220616d6f756e74206d7573742062652067726174657220745f8201527f68616e2030200000000000000000000000000000000000000000000000000000602082015250565b5f610d04602683610b29565b9150610d0f82610caa565b604082019050919050565b5f6020820190508181035f830152610d3181610cf8565b9050919050565b5f608082019050610d4b5f830187610acc565b610d586020830186610a1c565b610d656040830185610a1c565b610d726060830184610acc565b95945050505050565b7f4e6f7420616e206f776e657200000000000000000000000000000000000000005f82015250565b5f610daf600c83610b29565b9150610dba82610d7b565b602082019050919050565b5f6020820190508181035f830152610ddc81610da3565b9050919050565b7f5472616e73616374696f6e20697320616c726561647920636f6e6669726d20625f8201527f79206f776e657200000000000000000000000000000000000000000000000000602082015250565b5f610e3d602783610b29565b9150610e4882610de3565b604082019050919050565b5f6020820190508181035f830152610e6a81610e31565b9050919050565b7f5472616e73616374696f6e20697320616c7265616479206578656375746564005f82015250565b5f610ea5601f83610b29565b9150610eb082610e71565b602082019050919050565b5f6020820190508181035f830152610ed281610e99565b9050919050565b5f81905092915050565b50565b5f610ef15f83610ed9565b9150610efc82610ee3565b5f82019050919050565b5f610f1082610ee6565b9150819050919050565b7f5472616e73616374696f6e20457865637574696f6e204661696c6564200000005f82015250565b5f610f4e601d83610b29565b9150610f5982610f1a565b602082019050919050565b5f6020820190508181035f830152610f7b81610f42565b905091905056fea2646970667358221220bebab229c2d25193a7fdd6eee02d922cb8258d06c1f6560ff2188f5bd5f89b0164736f6c634300081a0033";

  const handleInputChange = (event) => {
    setWalletAddress(event.target.value);
  };

  const handleSubmit = async () => {
    const signer = await getsigner();
    const ContractFactory = new ethers.ContractFactory(
      CONTRACT_ABI,
      bytecode,
      signer
    );
    const contract = await ContractFactory.deploy([signer.getAddress(), walletAddress], 2);
    nav("/connected");
    await contract.deploymentTransaction();
    console.log(contract.getAddress());
  };
  
  return (
    <div className="connect-container">
      <div className="step-indicator">
        <span className="step-number">2</span> /
        <span className="step-number-total">2</span>
      </div>
      <h1 className="title pr-12">Connect Your Partner</h1>

      <div className="number-section">
        <p className="connect-wallet p-10">
          <b>Connect Wallet Link</b>
        </p>
        <img
          src="/images/shiny-happy-socializing.png"
          alt="image"
          className="girl-image"
        />
      </div>

      <div className="input-section">
        <input
          type="text"
          className="input-field"
          placeholder="Enter your partner's wallet address"
          value={walletAddress}
          onChange={handleInputChange}
        />
        <button onClick={handleSubmit} className="confirm-button">
          Confirm
        </button>
      </div>
    </div>
  );
}

export default ConnectCode;
